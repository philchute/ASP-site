@page "/gundam/timeline/{name?}"
@model ASP_site.Pages.Gundam.TimelineModel
@{
    ViewData["Title"] = string.IsNullOrEmpty(Model.TimelineName) ? "Gunpla Timeline List" : $"{Model.TimelineName} Kits";
}

<style>
    .kit-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 20px;
        margin-top: 20px;
    }
    .kit-card {
        background: #262626;
        border: 1px solid #444;
        border-radius: 6px;
        padding: 15px;
        position: relative;
    }
    .kit-card a {
        text-decoration: none;
        color: inherit;
        display: block;
    }
    .kit-grade {
        background: #00bcd4;
        color: #000;
        display: inline-block;
        padding: 2px 8px;
        border-radius: 4px;
        font-weight: bold;
        font-size: 0.8em;
        margin-bottom: 10px;
    }
    h1, h2, h3 { color: #00bcd4; margin-top: 1.5em; margin-bottom: 0.5em; }
    h1 { margin-top: 0; font-family: 'Orbitron', sans-serif; border-bottom: 2px solid #333; padding-bottom: 10px; }
</style>

<div class="container mt-4">
    <a asp-page="/Gundam/Dashboard" class="btn btn-outline-secondary mb-4">&larr; Back to Dashboard</a>

    @if (string.IsNullOrEmpty(Model.TimelineName))
    {
        <div class="text-center mb-4">
            <h3>Browse Kits by Timeline</h3>
            <div class="d-flex justify-content-center gap-2 flex-wrap">
                @foreach (var timeline in Model.AllTimelines)
                {
                    <a asp-page="/Gundam/Timeline" asp-route-name="@timeline" class="btn btn-outline-info">@timeline</a>
                }
            </div>
        </div>

        @if (Model.TimelineInfo != null)
        {
            <div class="markdown-content" style="max-width: 800px; margin: 0 auto;">
                @Html.Raw(Model.TimelineInfo.Content)
            </div>
        }
        else
        {
            <p>Timeline information not found.</p>
        }
    }
    else
    {
        <div class="container-fluid">
            <h1 style="color: #00bcd4;">@Model.TimelineName</h1>
            <p class="text-muted mb-4">Displaying all kits from this timeline.</p>

            <div class="kit-grid">
                @foreach (var kit in Model.Kits.OrderBy(k => k.Grade).ThenBy(k => k.ReleaseYear))
                {
                    <div class="kit-card">
                        <a asp-page="/Gundam/Kits/Details" asp-route-id="@kit.Id">
                            <span class="kit-grade">@kit.Grade</span>
                            <h4 class="mt-2">@(kit.KitName ?? kit.Gundams.FirstOrDefault()?.CommonName)</h4>
                            <div class="text-muted small">@kit.Gundams.FirstOrDefault()?.ModelNumber</div>
                            <div class="mt-2 text-white-50">Released: @kit.ReleaseYear</div>
                        </a>
                    </div>
                }
            </div>
            
            @if (!Model.Kits.Any())
            {
                <p>No kits found for this timeline.</p>
            }
        </div>
    }
</div>