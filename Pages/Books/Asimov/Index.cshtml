@page
@model ASP_site.Pages.Books.Asimov.IndexModel
@using ASP_site.Models
@using ASP_site.Helpers

@{
    ViewData["Title"] = "Isaac Asimov";
    ViewData["ActivePage"] = "Asimov";
}

<form class="mb-4">
    <div class="row align-items-end">
        <div class="col-md-5">
            <h2 class="display-3">Isaac Asimov</h2>
        </div>
        <div class="col-md-7">
            <div class="d-flex justify-content-end align-items-end">
                <div class="form-group me-2">
                    <label class="form-label" for="search-input">Search:</label>
                    <div class="d-flex">
                        <input id="search-input" class="form-control" type="text" asp-for="SearchString" />
                        <button class="btn btn-secondary ms-1" type="submit">Search</button>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label" for="sort-select">Sort by:</label>
                    <select id="sort-select" class="form-control" asp-for="SortField" asp-items="Model.SortOptions" onchange="this.form.submit();"></select>
                </div>
            </div>
        </div>
    </div>
    <hr />
    <div class="row mt-3">
        <div class="col-md-2">
            <label class="form-label fw-bold">Type:</label>
            @foreach (var type in Model.AllBookTypes)
            {
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="SelectedBookTypes" value="@type.Key" id="type_@type.Key.GetHashCode()" checked="@(Model.SelectedBookTypes.Contains(type.Key))" onchange="this.form.submit();" />
                    <label class="form-check-label" for="type_@type.Key.GetHashCode()">@type.Value</label>
                </div>
            }
        </div>
        <div class="col-md-2">
            <label class="form-label fw-bold">Tags:</label>
            @foreach (var tag in Model.AllTags)
            {
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" name="SelectedTags" value="@tag.Key" id="tag_@tag.Key.GetHashCode()" checked="@(Model.SelectedTags.Contains(tag.Key))" onchange="this.form.submit();" />
                    <label class="form-check-label" for="tag_@tag.Key.GetHashCode()">@tag.Value</label>
                </div>
            }
        </div>
        <div class="col-md-8">
            <label class="form-label fw-bold">Collections:</label>
            <div class="row">
                @foreach (var chunk in Model.AllCollections.Select((value, i) => new { i, value }).GroupBy(x => x.i / (int)Math.Ceiling((double)Model.AllCollections.Count / 3)))
                {
                    <div class="col-4">
                        @foreach (var item in chunk)
                        {
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="SelectedCollections" value="@item.value.Key" id="coll_@item.value.Key.GetHashCode()" checked="@(Model.SelectedCollections.Contains(item.value.Key))" onchange="this.form.submit();" />
                                <label class="form-check-label" for="coll_@item.value.Key.GetHashCode()">@item.value.Value</label>
                            </div>
                        }
                    </div>
                }
            </div>
        </div>
    </div>
</form>

<p>
    <a href="https://en.wikipedia.org/wiki/Isaac_Asimov">Isaac Asimov</a> (1920-1992) was one of the most prolific American writers of the 20th century.
    During his lifetime he published 40 novels, 383 short stories, and over 280 non-fiction books. His most famous and influential works 
    were the <a href="https://en.wikipedia.org/wiki/Robot_series">Robot</a> series, the <a href="https://en.wikipedia.org/wiki/Foundation_(Asimov_series)">Foundation</a> series,
    and the <a href="https://en.wikipedia.org/wiki/Galactic_Empire_series">Galactic Empire</a> series. These began as individual short stories which were then compiled into novels
    and later expanded on, connecting to each other as the '<a href="https://en.wikipedia.org/wiki/Foundation_universe">Foundation universe</a>'.
</p>
<p>
    Robot series: 37 short stories, 4 novels, plus 'I, Robot' which is listed as a novel and a collection because of the additional frame story which is not reprinted in short story collections. 
    'The Complete Robot' is 31 of the 37 stories. 'The Rest of the Robots' contains 8 short stories and 2 novels, but some paperback editions exclude the two novels, 
    sometimes titled 'Eight Stories from the Rest of the Robots'. Several other authors have written novels in the Robot series since Asimov's death.
</p>
<p>
    The First three Foundation novels were collected from short stories, and the later Foundation titles were written as novels.
    After Asimov's death, a second prequel trilogy was written by other authors; 
    Foundation's Fear (1997) by Gregory Benford, Foundation and Chaos (1998) by Greg Bear, and Foundation's Triumph (1999) by David Brin.
</p>

<section class="grid mt-3">
    <div class="row g-0 bg-dark text-white fw-bold">
        <div class="p-1 text-center col-1 col-sm-2">Year</div>
        <div class="p-1 text-center col-1 col-sm-1">Type</div>
        <div class="p-1 text-start col-5 col-sm-3">Title <i>(@(Model.Books?.Count ?? 0) shown)</i></div>
        <div class="p-1 text-start col-2 col-sm-2">Tags</div>
        <div class="p-1 text-start col-3 col-sm-4">Collections</div>
    </div>

    @if(Model.Books != null && Model.Books.Any()) {
        foreach (var book in Model.Books) { 
            var collections = book.Tags.Where(t => t.Name.StartsWith("Collection: ")).ToList();
            var generalTags = book.Tags.Where(t => !t.Name.StartsWith("Collection: ")).ToList();

            <a asp-page="../Book" asp-route-BookTitle="@book.Title" class="row g-0 text-decoration-none text-reset border-bottom table-row-hover">
                <div class="p-1 text-center col-12 col-sm-2">
                    @if (book.PublicationMonth.HasValue)
                    {
                        <span>@ViewHelper.GetMonthName(book.PublicationMonth), </span>
                    }
                    @book.PublicationYear
                </div>
                <div class="p-1 text-center col-12 col-sm-1">@book.Type</div>
                <div class="p-1 text-start col-12 col-sm-3 text-white">@book.Title</div>
                <div class="p-1 text-start col-12 col-sm-2">
                    @foreach (var tag in generalTags)
                    {
                        <span class="badge bg-secondary me-1">@tag.Name</span>
                    }
                </div>
                <div class="p-1 text-start col-12 col-sm-4 d-flex flex-wrap align-content-start">
                    @foreach (var collection in collections)
                    {
                        <span class="badge bg-secondary me-1 mb-1">@collection.Name.Replace("Collection: ", "")</span>
                    }
                </div>
            </a>
        }
    } else {
        <p class="p-2">No books found matching your criteria.</p>
    }
</section> 

<style>
    .table-row-hover:hover {
        background-color: #303030;
    }
</style> 