@page "{PieceID}"
@model ASP_site.Pages.Chess.PieceModel
@{
    ViewData["Title"] = Model.Piece.DisplayName;
}

<div class="container mt-4">
    <div class="row">
        <!-- Info Column -->
        <div class="col-md-6">
            <h1 class="display-4">@Model.Piece.DisplayName</h1>
            
            @if (!string.IsNullOrEmpty(Model.Piece.MoveDescription))
            {
                <p class="lead">@Model.Piece.MoveDescription</p>
            }
            
            @if (!string.IsNullOrEmpty(Model.Piece.History))
            {
                <div class="alert alert-secondary mt-3">
                    <h5 class="alert-heading"><i class="bi bi-book"></i> History & Origins</h5>
                    <p class="mb-0">@Model.Piece.History</p>
                </div>
            }

            <dl class="row mt-4">
                <dt class="col-sm-3">Symbol</dt>
                <dd class="col-sm-9"><span class="badge bg-secondary">@Model.Piece.Symbol</span></dd>

                <dt class="col-sm-3">Notation</dt>
                <dd class="col-sm-9"><span class="badge bg-info text-white">@Model.Piece.Notation</span></dd>
                
                <dt class="col-sm-3">Value</dt>
                <dd class="col-sm-9"><span class="badge bg-success">@Model.Piece.Value</span></dd>
                
                @if (!string.IsNullOrEmpty(Model.Piece.PromotesTo))
                {
                    <dt class="col-sm-3">Promotes To</dt>
                    <dd class="col-sm-9">
                        @if (Model.Piece.PromotesTo == "Any")
                        {
                            <span class="text-muted">Any captured piece / Any piece</span>
                        }
                        else
                        {
                            <a asp-page="/Chess/Piece" asp-route-PieceID="@Model.Piece.PromotesTo" class="text-decoration-none">@Model.Piece.PromotesTo</a>
                        }
                    </dd>
                }

                @if (Model.Aliases.Any())
                {
                    <dt class="col-sm-3">Aliases</dt>
                    <dd class="col-sm-9">
                        <ul class="list-unstyled mb-0">
                            @foreach (var alias in Model.Aliases)
                            {
                                <li class="mb-1">
                                    <strong>@alias.Name</strong>
                                    @if(alias.Variants.Any())
                                    {
                                        <span class="ms-1">
                                            @foreach(var v in alias.Variants)
                                            {
                                                if (!string.IsNullOrEmpty(v.Id) && v.Id != v.Name)
                                                {
                                                     var badgeClass = v.IsArmy ? "badge bg-info text-white" : "badge bg-secondary text-white";
                                                     <a asp-page="/Chess/Variants/Variant" asp-route-id="@v.Id" class="@badgeClass text-decoration-none border ms-1">@v.Name</a>
                                                }
                                                else
                                                {
                                                     var badgeClass = v.IsArmy ? "badge bg-info text-white" : "badge text-muted border-secondary";
                                                     <span class="@badgeClass ms-1">@v.Name</span>
                                                }
                                            }
                                        </span>
                                    }
                                </li>
                            }
                        </ul>
                    </dd>
                }
            </dl>
            
            <div class="mt-4 d-flex gap-2">
                <a asp-page="./Pieces" class="btn btn-outline-primary">&larr; Back to Pieces</a>
                <a asp-page="./Armies/Index" class="btn btn-outline-secondary">Back to Armies</a>
                <a asp-page="./Parser" class="btn btn-outline-secondary">Notation Parser</a>
            </div>
        </div>
        
        <!-- Board Visualization Column -->
        <div class="col-md-6 d-flex flex-column align-items-center">
            <partial name="_ChessBoard" model="Model.BoardViewModel" />

            @* Legend for the move boards *@
            <div class="row justify-content-center mt-4">
                <div class="col-auto">
                    @{
                        var legendVm = ASP_site.Models.ViewModels.LegendViewModel.FromMoves(Model.BoardViewModel.Trajectories);
                    }
                    <partial name="_MoveLegend" model="legendVm" />
                </div>
            </div>
        </div>
    </div>
</div>
