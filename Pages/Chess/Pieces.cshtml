@page
@model ASP_site.Pages.Chess.PiecesModel

@{
    ViewData["Title"] = "Chess Pieces";
}

<div class="container mt-4">
    <form method="get" class="mb-4">
        <div class="row align-items-end">
            <div class="col-md-5">
                <h1 class="display-4">Chess Pieces</h1>
                <p class="lead">This page lists all the pieces in my database.
                    Each piece page will show information about the piece and the variants it is available in.
                </p>
            </div>
            <div class="col-md-7">
                <div class="d-flex justify-content-end align-items-end flex-wrap gap-2">
                    <div class="form-group">
                        <label class="form-label" for="SelectedGame">Game:</label>
                        <select id="SelectedGame" name="SelectedGame" asp-items="Model.GameOptions" class="form-control" onchange="this.form.submit()">
                            <option value="">All Games</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="SearchString">Search:</label>
                        <div class="d-flex">
                            <input id="SearchString" type="text" name="SearchString" value="@Model.SearchString" class="form-control" placeholder="Search..." />
                            <button class="btn btn-secondary ms-1" type="submit">Search</button>
                        </div>
                    </div>

                    <div class="form-check align-self-end mb-2 ms-2">
                        <input class="form-check-input" type="checkbox" id="HideDuplicates" name="HideDuplicates" value="true" checked="@Model.HideDuplicates" onchange="this.form.submit()">
                        <label class="form-check-label" for="HideDuplicates">Hide Duplicates</label>
                    </div>
                </div>
                @if (!string.IsNullOrEmpty(Model.SearchString) || !string.IsNullOrEmpty(Model.SelectedGame))
                {
                    <div class="d-flex justify-content-end mt-2">
                        <a asp-page="./Pieces" class="btn btn-outline-secondary btn-sm">Clear Filters</a>
                    </div>
                }
            </div>
        </div>
    </form>

    <div class="table-responsive">
        <table class="table table-hover table-striped">
            <thead class="table-dark">
                <tr>
                    <th style="width: 20%">
                        <a asp-page="./Pieces" asp-route-sortOrder="@Model.NameSort" class="text-white text-decoration-none">
                            Name <i class="bi bi-arrow-down-up small"></i>
                        </a>
                        <span class="fw-normal fst-italic ms-2">(@Model.DisplayPieces.Count shown)</span>
                    </th>
                    <th style="width: 20%">Variants</th>
                    <th style="width: 20%">Armies</th>
                    <th class="text-center" style="width: 10%">
                        <a asp-page="./Pieces" asp-route-sortOrder="@Model.SymbolSort" class="text-white text-decoration-none">
                            Symbol <i class="bi bi-arrow-down-up small"></i>
                        </a>
                    </th>
                    <th style="width: 15%">
                        <a asp-page="./Pieces" asp-route-sortOrder="@Model.NotationSort" class="text-white text-decoration-none">
                            Notation <i class="bi bi-arrow-down-up small"></i>
                        </a>
                    </th>
                    <th class="text-center" style="width: 10%">
                        <a asp-page="./Pieces" asp-route-sortOrder="@Model.ValueSort" class="text-white text-decoration-none">
                            Value <i class="bi bi-arrow-down-up small"></i>
                        </a>
                    </th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model.DisplayPieces)
                {
                    <tr>
                        <td>
                            <a asp-page="./Piece" asp-route-PieceID="@item.Piece.PieceID" class="fw-bold text-decoration-none">
                                @item.DisplayName
                            </a>
                        </td>
                        <td>
                            @if (item.Variants.Any())
                            {
                                <div class="d-flex flex-wrap gap-1">
                                    @foreach(var v in item.Variants)
                                    {
                                        if (!string.IsNullOrEmpty(v.Id) && v.Id != v.Name)
                                        {
                                            <a asp-page="./Variants/Variant" asp-route-id="@v.Id" class="badge bg-secondary text-decoration-none" title="@v.Name">@v.Name</a>
                                        }
                                        else
                                        {
                                             <span class="badge text-muted border border-secondary">@v.Name</span>
                                        }
                                    }
                                </div>
                            }
                            else
                            {
                                <span class="text-muted small">-</span>
                            }
                        </td>
                        <td>
                            @if (item.Armies.Any())
                            {
                                <div class="d-flex flex-wrap gap-1">
                                    @foreach(var a in item.Armies)
                                    {
                                        <a asp-page="./Armies/Army" asp-route-ArmyID="@a.Id" class="badge bg-info text-dark text-decoration-none" title="@a.Name">@a.Name</a>
                                    }
                                </div>
                            }
                            else
                            {
                                <span class="text-muted small">-</span>
                            }
                        </td>
                        <td class="text-center">
                            <a asp-page="./Piece" asp-route-PieceID="@item.Piece.PieceID" class="text-decoration-none">
                                <span class="badge bg-secondary">@Html.DisplayFor(modelItem => item.Piece.Symbol)</span>
                            </a>
                        </td>
                        <td>
                            <a asp-page="./Piece" asp-route-PieceID="@item.Piece.PieceID" class="text-decoration-none d-block">
                                <code class="text-white" title="@item.Piece.MoveDescription" data-bs-toggle="tooltip">@Html.DisplayFor(modelItem => item.Piece.Notation)</code>
                            </a>
                        </td>
                        <td class="text-center">
                            @Html.DisplayFor(modelItem => item.Piece.Value)
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>
